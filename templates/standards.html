{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Performance Standards</h2>
    <p>Set standard targets for mortality, body weight, and egg production by week.</p>

    <div class="card mb-4">
        <div class="card-header">Global Standards (Mortality)</div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('manage_standards') }}">
                <input type="hidden" name="action" value="update_global">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Daily Mortality % Target</label>
                        <input type="number" step="0.01" name="std_mortality_daily" class="form-control" value="{{ global_std.std_mortality_daily }}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Weekly Mortality % Target</label>
                        <input type="number" step="0.01" name="std_mortality_weekly" class="form-control" value="{{ global_std.std_mortality_weekly }}">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Update Global Standards</button>
            </form>
        </div>
    </div>

    <form method="POST" action="{{ url_for('manage_standards') }}">
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Week</th>
                        <th>Std Mort Male %</th>
                        <th>Std Mort Fem %</th>
                        <th>Std BW Male (g)</th>
                        <th>Std BW Fem (g)</th>
                        <th>Std Egg Prod %</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in standards %}
                    <tr>
                        <td>{{ s.week }}</td>
                        <td>{{ s.std_mortality_male }}</td>
                        <td>{{ s.std_mortality_female }}</td>
                        <td>{{ s.std_bw_male }}</td>
                        <td>{{ s.std_bw_female }}</td>
                        <td>{{ s.std_egg_prod }}</td>
                        <td>
                            <!-- Minimal inline edit logic or just delete? -->
                            <a href="#" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#editModal{{ s.id }}">Edit</a>
                        </td>
                    </tr>

                    <!-- Edit Modal -->
                    <div class="modal fade" id="editModal{{ s.id }}" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Edit Week {{ s.week }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="hidden" name="action" value="update">
                                    <input type="hidden" name="id" value="{{ s.id }}">
                                    <!-- This form inside a loop is tricky for single submit.
                                         Better to use JS or separate forms.
                                         Let's use a separate form inside the modal for updating ONE row. -->
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Add New Row -->
                    <tr>
                        <td><input type="number" name="week" class="form-control" placeholder="Week"></td>
                        <td><input type="number" step="0.01" name="std_mortality_male" class="form-control" placeholder="%"></td>
                        <td><input type="number" step="0.01" name="std_mortality_female" class="form-control" placeholder="%"></td>
                        <td><input type="number" step="0.1" name="std_bw_male" class="form-control" placeholder="g"></td>
                        <td><input type="number" step="0.1" name="std_bw_female" class="form-control" placeholder="g"></td>
                        <td><input type="number" step="0.1" name="std_egg_prod" class="form-control" placeholder="%"></td>
                        <td>
                            <button type="submit" name="action" value="add" class="btn btn-success btn-sm">Add</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </form>

    <!-- Bulk Upload / Seed could be here -->
</div>
{% endblock %}
