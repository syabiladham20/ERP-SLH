{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Import Preview</h2>

    {% if warnings %}
    <div class="alert alert-warning">
        <strong>Warnings:</strong>
        <ul>
            {% for w in warnings %}
            <li>{{ w }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="alert alert-info">
        <strong>Summary:</strong>
        Found {{ changes|length }} rows to update/insert.
        <br>
        Please review the data below. If everything looks correct, click "Confirm Import".
    </div>

    <form method="POST" action="{{ url_for('import_data') }}">
        <input type="hidden" name="confirm_file" value="{{ filename }}">
        <button type="submit" class="btn btn-success mb-3">Confirm Import</button>
        <a href="{{ url_for('import_data') }}" class="btn btn-secondary mb-3">Cancel</a>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-bordered table-sm">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>House</th>
                    <th>Flock</th>
                    <th>Type</th>
                    <th>Mortality (M/F)</th>
                    <th>Culls (M/F)</th>
                    <th>Eggs</th>
                    <th>Feed (M/F)</th>
                    <th>Water</th>
                </tr>
            </thead>
            <tbody>
                {% for change in changes %}
                <tr class="{% if change.type == 'New' %}table-success{% endif %}">
                    <td>{{ change.date | date_fmt }}</td>
                    <td>{{ change.house }}</td>
                    <td>{{ change.flock }}</td>
                    <td>
                        {% if change.type == 'New' %}
                        <span class="badge bg-success">New</span>
                        {% else %}
                        <span class="badge bg-primary">Update</span>
                        {% endif %}
                    </td>
                    <td>{{ change.mortality_male }} / {{ change.mortality_female }}</td>
                    <td>{{ change.culls_male }} / {{ change.culls_female }}</td>
                    <td>{{ change.eggs }}</td>
                    <td>{{ change.feed_male_gp_bird }} / {{ change.feed_female_gp_bird }}</td>
                    <td>{{ change.water_reading_1 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <form method="POST" action="{{ url_for('import_data') }}">
        <input type="hidden" name="confirm_file" value="{{ filename }}">
        <button type="submit" class="btn btn-success mt-3">Confirm Import</button>
        <a href="{{ url_for('import_data') }}" class="btn btn-secondary mt-3">Cancel</a>
    </form>
</div>
{% endblock %}
